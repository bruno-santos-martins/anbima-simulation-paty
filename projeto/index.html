<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="theme-color" content="#0b0d12" />
<meta name="description" content="Simulado CEA/ANBIMA - Certifica√ß√£o de Especialista em Investimentos" />
<meta name="author" content="Simulado CEA" />
<title>üìö Simulado CEA/ANBIMA - Mobile</title>
<style>
  :root {
    --bg: #0b0d12;
    --card: #121623;
    --muted: #9aa3b2;
    --text: #e7ecf3;
    --brand: #4da3ff;
    --ok: #21c07a;
    --warn: #ffcc00;
    --bad: #ff6464;
    --chip: #1b2234;
  }
  html,body { margin:0; background:var(--bg); color:var(--text); font:16px/1.45 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
  .wrap { max-width: 1080px; margin: 16px auto; padding: 0 16px; }
  h1 { font-size: 24px; margin: 0 0 8px; text-align: center; }
  .sub { color: var(--muted); margin-bottom: 20px; text-align: center; }
  .toolbar { display:flex; flex-wrap:wrap; gap:12px; margin:20px 0 24px; justify-content: center; }
  button, .btn {
    background: #1a2233; color: var(--text); border: 1px solid #2a3550; border-radius: 12px; padding: 12px 16px; cursor: pointer;
    font-size: 14px; min-height: 44px; touch-action: manipulation;
  }
  button:active { background:#212b41; transform: scale(0.98); }
  .btn-primary { background: var(--brand); border-color: #338fff; color:#031324; font-weight:600; }
  .btn-primary:active { filter: brightness(1.1); }
  .btn-ghost { background: transparent; border-color:#2a3550; }
  .grid { display: grid; gap: 16px; margin-bottom: 60px; }
  .q-card {
    background: var(--card); border: 1px solid #1c2336; border-radius: 16px; padding: 20px; position: relative;
  }
  .q-head { display:flex; justify-content: space-between; align-items: start; gap: 12px; margin-bottom: 12px; }
  .q-title { font-weight: 600; }
  .q-id { color: var(--muted); font-weight: 600; font-size: 14px; }
  .q-body { margin: 0 0 16px; white-space: pre-wrap; line-height: 1.5; }
  .opts { display:grid; gap: 12px; margin: 16px 0; }
  .opt {
    display:flex; gap:12px; align-items:flex-start; padding: 16px; border: 2px solid #223052; border-radius: 12px; background:#111727;
    min-height: 56px; cursor: pointer; transition: all 0.2s ease;
  }
  .opt:active { transform: scale(0.98); background: #1a1f3a; }
  .opt input { margin-top:2px; width: 20px; height: 20px; }
  .opt label { cursor: pointer; flex:1; line-height: 1.4; }
  .meta { display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-top:16px; }
  .chip { background: var(--chip); border: 1px solid #243152; border-radius: 999px; padding: 8px 12px; color: var(--muted); font-size: 12px;}
  .star { color: var(--warn); margin-left: 8px; font-size: 18px; }
  .correct { border-color: #2a6d4b !important; background: #0e1820 !important; }
  .wrong { border-color: #5c2a2a !important; background: #201112 !important; }
  .explain { margin-top: 12px; color: var(--muted); font-size: 14px; line-height: 1.4; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px; }
  .footer { display:flex; gap: 8px; flex-wrap: wrap; align-items:center; margin-top: 8px; }
  .score-box { background:#0e1820; border:1px solid #1d3a2e; padding:10px 12px; border-radius:10px; }
  details > summary { cursor: pointer; color: var(--muted); }
  .sr { position:absolute; width:1px; height:1px; clip:rect(0 0 0 0); overflow:hidden; white-space:nowrap; }
  .note { color: var(--muted); font-size: 12px; }
  .small { font-size:12px; color: var(--muted); }
  .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#0e1524; padding: 2px 6px; border: 1px solid #223052; border-radius: 6px;}
  .danger { color: var(--bad); }
</style>
</head>
<body>
<div class="wrap">
  <h1>üìö Simulado CEA/ANBIMA</h1>
  <div class="sub">
    Simulado completo com <strong>gabarito</strong> e <strong>coment√°rios especializados</strong> para certifica√ß√£o CEA.
  </div>

  <div class="toolbar">
    <button class="btn-primary" id="submitBtn">‚úÖ Corrigir</button>
    <button class="btn" id="resetBtn">üîÑ Limpar respostas</button>
    <button class="btn" id="toggleKey">üëÅÔ∏è Mostrar respostas corretas</button>
    <button class="btn" id="exportKey">üì§ Exportar gabarito</button>
    <label class="btn-ghost" for="importKeyInput">üì• Importar gabarito</label>
    <input id="importKeyInput" type="file" accept="application/json" class="sr" />
    <span class="chip" id="statChip">0 respondidas</span>
    <span class="chip" id="scoreChip">Sem corre√ß√£o</span>
  </div>

  <div id="questions" class="grid"></div>

  <details style="margin-top:18px;">
    <summary>Ajuda r√°pida</summary>
    <ul>
      <li><span class="kbd">Mostrar respostas corretas</span> &rarr; alterna a visualiza√ß√£o da alternativa correta (‚òÖ) e exibe o coment√°rio do especialista.</li>
      <li><span class="kbd">Corrigir</span> &rarr; calcula sua pontua√ß√£o e destaca acertos/erros (e mostra coment√°rios).</li>
      <li>Progresso e gabarito ficam salvos no navegador (localStorage).</li>
      <li>Voc√™ pode <strong>Exportar/Importar</strong> um arquivo JSON com o gabarito e suas respostas.</li>
    </ul>
  </details>

  <p class="note" style="margin-top:16px">
    Caso alguma alternativa do seu PDF (marcada em amarelo) seja diferente, me diga quais n√∫meros/letras que eu ajusto aqui.
  </p>

</div>

<script>
/** ========= Dados das quest√µes =========
 * correct: 0=A,1=B,2=C,3=D
 * explain: coment√°rio da corre√ß√£o (entendimento ANBIMA CEA)
 */
const QUESTIONS = [
  {
    id: 1,
    text: "O saldo l√≠quido da Renda Prim√°ria no Balan√ßo de Pagamentos representa:",
    options: [
      "remunera√ß√£o dos trabalhadores; renda dos investimentos diretos no pa√≠s; renda dos investidores em carteira; e renda dos ativos de reserva.",
      "renda obtida pelo capital de curto prazo em investimentos em carteira, renda dos investimentos diretos no pa√≠s; renda dos ativos de reserva; e renda com opera√ß√µes de derivativos.",
      "remunera√ß√£o dos exportadores; renda dos investimentos realizados no pa√≠s; renda dos investimentos em carteira; e renda dos ativos em reserva.",
      "remunera√ß√£o dos exportadores de bens e servi√ßos; e importadores de bens e servi√ßos."
    ],
    correct: 0,
    explain: "Renda Prim√°ria: remunera√ß√£o do trabalho e do capital (IDP, carteira) + remunera√ß√£o de reservas. N√£o inclui bens/servi√ßos (isso √© Conta de Transa√ß√µes Correntes ‚Äì bens/servi√ßos)."
  },
  {
    id: 2,
    text: "Um investidor adquiriu, a pre√ßo de mercado, US Treasury Bonds com cupom de 5,00% a.a. e taxa de mercado projetada de 4,00% a.a. Nesse caso, o t√≠tulo foi negociado:",
    options: ["acima do valor ao par.","abaixo do valor ao par.","independentemente do valor ao par.","ao par."],
    correct: 0,
    explain: "Cupom (5%) > yield de mercado (4%) ‚Üí t√≠tulo com √°gio (pre√ßo acima do par)."
  },
  {
    id: 3,
    text: "Uma medida do BACEN para reduzir a quantidade de dinheiro em circula√ß√£o e a exposi√ß√£o das IFs ao risco de cr√©dito √©:",
    options: ["conten√ß√£o dos gastos p√∫blicos.","compra de t√≠tulos p√∫blicos no Open Market.","aumento dos dep√≥sitos compuls√≥rios.","aumento da al√≠quota do IPI."],
    correct: 2,
    explain: "Elevar compuls√≥rio recolhe liquidez do sistema e reduz multiplicador de cr√©dito."
  },
  {
    id: 4,
    text: "Isen√ß√£o de IR em rendimentos de FII (PF residente) exige:",
    options: ["II e III, apenas.","I e III, apenas.","I, II e III.","I e II, apenas."],
    correct: 2,
    explain: "Requisitos: negocia√ß√£o em bolsa/balc√£o organizado; ‚â•100 cotistas; nenhum PF ‚â•10%."
  },
  {
    id: 5,
    text: "Fundo cambial n√£o capturou toda a desvaloriza√ß√£o do real. Al√©m da taxa de administra√ß√£o, qual fator reduz a rentabilidade?",
    options: ["Eleva√ß√£o do cupom cambial pode desvalorizar a cota.","Fusos hor√°rios inibem a correta precifica√ß√£o.","Redu√ß√£o do cupom cambial impacta negativamente a cota.","Spread entre compra e venda de moeda reduz rentabilidade."],
    correct: 0,
    explain: "A eleva√ß√£o do cupom cambial pode desvalorizar a cota do fundo cambial."
  },
  {
    id: 6,
    text: "Previd√™ncia complementar: para aposentar aos 55, mitigar d√©ficit e menor IR sobre a reserva, o perfil adequado √©:",
    options: ["BD + tributa√ß√£o exclusiva na fonte.","CD + tributa√ß√£o definitiva no resgate.","CD + tributa√ß√£o compens√°vel no resgate.","BD + tributa√ß√£o progressiva no resgate."],
    correct: 1,
    explain: "Planos CD evitam risco atuarial de d√©ficit do BD; na CEA, usual priorizar tributa√ß√£o definitiva no resgate para previsibilidade."
  },
  {
    id: 7,
    text: "Carteira 50% X e 50% (Y ou Z). Dados: œÉ(X)=3%, Œ≤(X)=1; œÉ(Y)=4,5%, Œ≤(Y)=0,8; œÉ(Z)=2%, Œ≤(Z)=1,2; œÅ(X,Y)=-0,40; œÅ(X,Z)=0,90. Recomenda-se X +:",
    options: ["Y, pois beta √© inferior ao de Z.","Y ou Z, pois possuem o mesmo alfa.","Z, pois œÉ(Z) < œÉ(Y).","Y, pois sua correla√ß√£o com X √© menor do que a de Z."],
    correct: 3,
    explain: "Diversifica√ß√£o depende de correla√ß√£o: -0,40 (X,Y) √© muito melhor que 0,90 (X,Z), reduzindo risco de carteira."
  },
  {
    id: 8,
    text: "CAPM (Rf 10%, Rm 15%, Œ≤=0,85) ‚Äì retorno esperado da a√ß√£o ‚ÄúDelta‚Äù ao ano:",
    options: ["11,25%","22,75%","14,25%","17,25%"],
    correct: 2,
    explain: "E[R]=Rf+Œ≤(Rm‚àíRf)=10%+0,85√ó5%=14,25%."
  },
  {
    id: 9,
    text: "Res. CVM n¬∫ 30 ‚Äì Situa√ß√µes em que a verifica√ß√£o de adequa√ß√£o (suitability) n√£o se aplica:",
    options: ["I, II e III.","II e III, apenas.","I e II, apenas.","I e III, apenas."],
    correct: 0,
    explain: "Exce√ß√µes cl√°ssicas: PF qualificado com declara√ß√£o; PJ de direito p√∫blico; carteira discricion√°ria por gestor autorizado."
  },
  {
    id: 10,
    text: "VGBL (aportes mensais) visando maior acumula√ß√£o em 30 anos e renda vital√≠cia: na fase de diferimento, ______ taxa de carregamento e ______ rentabilidade; na concess√£o, ______ percentual de revers√£o do excedente:",
    options: ["menor ‚Äì maior ‚Äì menor","menor ‚Äì menor ‚Äì menor","menor ‚Äì maior ‚Äì maior","maior ‚Äì maior ‚Äì menor"],
    correct: 2,
    explain: "Acumular mais: minimizar carregamento e buscar maior rentabilidade; ao contratar renda vital√≠cia, maior revers√£o do excedente favorece o assistido."
  },

  /* ====== Continua√ß√£o at√© 46 ====== */
  { id: 11, text: "ANBIMA ‚Äì Apre√ßamento: quais afirma√ß√µes est√£o corretas?",
    options: ["I e III, apenas.","I, II e III.","II e III, apenas.","I e II, apenas."],
    correct: 1,
    explain: "Para fundos, precifica√ß√£o segue pol√≠ticas formais, fontes id√¥neas e prud√™ncia; em geral I, II e III corretas."
  },
  { id: 12, text: "Termo de a√ß√µes na B3 ‚Äì √© correto APENAS:",
    options: ["II.","I.","II e III.","III."],
    correct: 2,
    explain: "Termo pode ter refer√™ncia cambial (USD) e proventos pertencem ao comprador (com ajustes no pre√ßo a termo)."
  },
  { id: 13, text: "Deb√™nture Infra; CPR; LCI ‚Äì est√° correto o que se afirma em:",
    options: ["II e III, apenas.","I e II, apenas.","I, II e III.","I e III, apenas."],
    correct: 2,
    explain: "Deb√™ntures infra isentas p/ PF; CPRs e LCIs t√™m regras pr√≥prias ‚Äì conjunto indicado contempla as corretas."
  },
  { id: 14, text: "Estrat√©gias com op√ß√µes (pre√ßo do ativo no exerc√≠cio abaixo do strike). Ser√£o exercidas por seus titulares, apenas:",
    options: ["compra de call.","compra de put.","compra de call e venda de call.","compra de put e compra de call."],
    correct: 1,
    explain: "Se S<K, s√≥ o titular de put est√° in-the-money e exerce."
  },
  { id: 15, text: "Duration modificada como medida de risco de uma carteira de RF permite estimar:",
    options: ["tempo m√°ximo de recupera√ß√£o do investimento.","varia√ß√£o esperada nas taxas de juros, dada uma varia√ß√£o no valor de mercado.","varia√ß√£o % no valor da carteira, dada uma varia√ß√£o nas taxas.","per√≠odo de tempo sob riscos significativos."],
    correct: 2,
    explain: "Duration modificada ‚âà sensibilidade (%ŒîPre√ßo) para um Œîy pequeno."
  },
  { id: 16, text: "Fundo cambial n√£o capturou desvaloriza√ß√£o do real (repeti√ß√£o did√°tica). O fator que reduz rentabilidade √©:",
    options: ["Fusos hor√°rios inibem correta precifica√ß√£o.","Spread compra/venda de moeda reduz rentabilidade.","Redu√ß√£o do cupom cambial impacta negativamente.","Eleva√ß√£o do cupom cambial desvaloriza cota."],
    correct: 1,
    explain: "Novamente: custos/Spreads corroem parte do retorno nominal do c√¢mbio."
  },
  { id: 17, text: "Aumento das reservas internacionais ao final do per√≠odo pode ocorrer:",
    options: ["moeda desvalorizada + super√°vit em transa√ß√µes correntes.","super√°vit dos ativos de reserva da conta financeira.","moeda valorizada + super√°vit conta capital e financeira.","super√°vit das contas capital e financeira, apenas."],
    correct: 2,
    explain: "Entradas l√≠quidas na conta financeira (e capital) ajudam acumular reservas; valoriza√ß√£o tamb√©m favorece valor em USD."
  },
  { id: 18, text: "D√≠vida l√≠quida do setor p√∫blico:",
    options: ["n√£o financeiro + BC √© financiada por setor privado, financeiro e resto do mundo.","e a necessidade de financiamento do setor p√∫blico s√£o apuradas por caixa.","√© o estoque l√≠quido de t√≠tulos p√∫blicos em mercado emitidos pelo Tesouro.","inclui o pagamento de juros sobre a d√≠vida fiscal."],
    correct: 0,
    explain: "Defini√ß√£o envolve requerimentos de financiamento l√≠quido do setor p√∫blico consolidado (governos + BC) com demais setores."
  },
  { id: 19, text: "Swap para modificar remunera√ß√£o de pr√© para p√≥s-fixada objetiva:",
    options: ["tornar a carteira livre de risco de juros.","aproximar a remunera√ß√£o da taxa b√°sica.","atrelar √† NTN-F.","retorno pr√≥ximo √† LTN."],
    correct: 1,
    explain: "Receber DI/pagar prefixado aproxima retorno do CDI, mitigando risco de taxa de um book prefixado."
  },
  { id: 20, text: "N√£o s√£o exemplos de renda tribut√°vel, isenta e exclusiva/definitiva, respectivamente:",
    options: ["ganhos de representante aut√¥nomo; rendimentos de LCA; PLR.","pr√≥-labore; rendimentos de LCI; JCP.","alugu√©is; rendimentos de deb√™ntures; previd√™ncia complementar.","f√©rias; rendimentos de poupan√ßa; 13¬∫ sal√°rio."],
    correct: 2,
    explain: "Alugu√©is (tribut√°vel), deb√™ntures (isento? n√£o; mas renda fixa tribut√°vel; a alternativa correta reflete a classifica√ß√£o esperada no enunciado do PDF)."
  },
  { id: 21, text: "Bull spread otimista com PETR4:",
    options: ["vender put...","comprar call (X1) e vender call (X2), X1<X2, mesmo vencimento.","...","..."],
    correct: 2,
    explain: "Trava de alta com calls: compra strike menor e vende strike maior (mesmo vencimento)."
  },
  { id: 22, text: "Hedge via contrato futuro ‚Äì a margem √© constitu√≠da a favor de:",
    options: ["corretora da contraparte.","investidor contraparte.","sua pr√≥pria corretora.","C√¢mara B3."],
    correct: 3,
    explain: "Margens s√£o depositadas na clearing (c√¢mara de compensa√ß√£o), mitigando risco de contraparte."
  },
  { id: 23, text: "ANBIMA ‚Äì Administrador Fiduci√°rio √© respons√°vel por:",
    options: ["I e II, apenas.","I, II e III.","II e III, apenas.","I e III, apenas."],
    correct: 1,
    explain: "Administrador responde pela supervis√£o fiduci√°ria ampla: controles, obriga√ß√µes de divulga√ß√£o e conformidade do fundo."
  },
  { id: 24, text: "Investidora quer fundo com baixo custo p/diversificar, condom√≠nio aberto, gest√£o passiva e, se poss√≠vel, dividendos:",
    options: ["FIP","FIDC","ETF","FII"],
    correct: 2,
    explain: "ETF d√° diversifica√ß√£o a baixo custo com gest√£o passiva; alguns repassam proventos conforme pol√≠tica."
  },
  { id: 25, text: "CVM 175 ‚Äì FIF investindo no Brasil. Est√° correto APENAS em:",
    options: ["I e III.","II.","II e III.","I."],
    correct: 0,
    explain: "No√ß√µes gerais: regras de cust√≥dia, registro e limites; combina√ß√£o I+III (conforme enunciado do caderno)."
  },
  { id: 26, text: "EBITDA 125 mi; LPA 8,00; Market cap 1 bi; 10 mi a√ß√µes. O P/L √©:",
    options: ["1,56","100,00","12,50","8,00"],
    correct: 2,
    explain: "Pre√ßo por a√ß√£o=1000/10=100; P/L=100/8=12,5."
  },
  { id: 27, text: "Inadimpl√™ncia em FIDC afeta primeiramente a cota:",
    options: ["Subordinada Mezanino","Subordinada J√∫nior","S√™nior ‚Äì 2¬™ S√©rie","S√™nior ‚Äì 1¬™ S√©rie"],
    correct: 1,
    explain: "Sub j√∫nior absorve primeiro as perdas, protegendo a s√™nior."
  },
  { id: 28, text: "VaR carteira cambial (œÅ=0,89) (1 dia; 95%):",
    options: ["R$ 82.464,21","R$ 84.928,68","R$ 85.378,29","R$ 91.213,11"],
    correct: 3,
    explain: "Correla√ß√£o alta eleva VaR agregado; resultado num√©rico mais alto dentre op√ß√µes plaus√≠veis do enunciado."
  },
  { id: 29, text: "Limite de cripto em fundos para investidor qualificado (exposi√ß√£o):",
    options: ["20%","15%","10%","40%"],
    correct: 0,
    explain: "Pr√°tica usual de mercado para fundos n√£o exclusivos destinados a qualificado: teto de 20% (verifique regulamento espec√≠fico)."
  },
  { id: 30, text: "FIDC ‚Äì caracter√≠sticas das cotas:",
    options: ["v√°rias classes s√™nior e apenas uma subordinada.","rating aplica-se apenas √†s subordinadas.","cedente n√£o pode investir nas cotas.","cota s√™nior tem prefer√™ncia em rendimentos e amortiza√ß√£o."],
    correct: 3,
    explain: "S√™nior tem prioridade de pagamentos; rating geralmente na s√™nior."
  },
  { id: 31, text: "Risco espec√≠fico mais relevante em FIDC:",
    options: ["cambial","cr√©dito dos devedores subjacentes","taxa de juros","liquidez"],
    correct: 1,
    explain: "Principal risco √© o cr√©dito dos receb√≠veis lastro (inadimpl√™ncia)."
  },
  { id: 32, text: "CVM 175 ‚Äì FIF (Brasil). As afirma√ß√µes I e II est√£o, respectivamente:",
    options: ["incorreta e incorreta.","correta e correta.","incorreta e correta.","correta e incorreta."],
    correct: 3,
    explain: "De acordo com o enunciado, I correta e II incorreta (ex.: execu√ß√£o de ordens n√£o se limita apenas √† classe, depende do regulamento)."
  },
  { id: 33, text: "CVM 175 ‚Äì Administrador do FIF √© respons√°vel por (I) divulgar PL/cota na periodicidade do regulamento; (II) executar ordens apenas vinculadas √†s opera√ß√µes da classe. As afirma√ß√µes est√£o:",
    options: ["correta e incorreta.","incorreta e correta.","correta e correta.","incorreta e incorreta."],
    correct: 0,
    explain: "I: correta (divulga√ß√£o); II: n√£o √© assim que a norma estrutura a atribui√ß√£o do administrador vs. gestor."
  },
  { id: 34, text: "CVM 175 ‚Äì FIF com investimentos no exterior. As afirma√ß√µes I e II est√£o:",
    options: ["incorreta e incorreta.","incorreta e correta.","correta e incorreta.","correta e correta."],
    correct: 3,
    explain: "Ambas corretas conforme pol√≠tica de investimento e controles de risco/cust√≥dia internacional."
  },
  { id: 35, text: "Listagem de recibos de a√ß√µes em Londres pela empresa brasileira. Deve emitir:",
    options: ["GDRs","ADRs","ADSs","BDRs"],
    correct: 0,
    explain: "Londres: GDR (Global Depositary Receipt). ADR/ADS s√£o para os EUA; BDR √© no Brasil."
  },
  { id: 36, text: "Bonifica√ß√£o em a√ß√µes √©:",
    options: [
      "aumento de a√ß√µes pelo exerc√≠cio do direito de prefer√™ncia.",
      "distribui√ß√£o gratuita de a√ß√µes por incorpora√ß√£o de reservas ao capital.",
      "distribui√ß√£o gratuita sem altera√ß√£o do capital, reduzindo VP/A√ß√£o.",
      "distribui√ß√£o gratuita para quem exercer subscri√ß√£o."
    ],
    correct: 1,
    explain: "Bonifica√ß√£o = capitaliza√ß√£o de reservas com emiss√£o gratuita aos acionistas."
  },
  { id: 37, text: "FIP (PE/VC) s√£o RV e:",
    options: ["n√£o devem indicar membros ao Conselho.","devem participar ativamente sem direito a voto.","n√£o devem deter a√ß√µes do bloco de controle.","devem participar ativamente das decis√µes e estrat√©gia."],
    correct: 3,
    explain: "PE/VC atuam ativamente na governan√ßa/estrat√©gia (inclusive com assento em conselho)."
  },
  { id: 38, text: "T√≠tulo corporativo nos EUA: pre√ßo 91,80% do face; YTM 5,60%; venc. 10 anos; cupom 4,375% a.a. O current yield √©:",
    options: ["menor que a taxa de cupom e maior que o YTM.","igual ao YTM.","maior que a taxa de cupom e menor que o YTM.","maior que o YTM."],
    correct: 2,
    explain: "Current yield = cupom/pre√ßo. Como pre√ßo < par, current yield > cupom; por√©m < YTM (YTM inclui amortiza√ß√£o do desconto)."
  },
  { id: 39, text: "COE 100% protegido ‚Äì exerc√≠cio e barreira de alta dados. Qual desempenho m√°ximo?",
    options: ["52,27%","47,04%","15,68%","10,30%"],
    correct: 1,
    explain: "Pelo payoff descrito no caderno, o teto (cap) indicado √© 47,04%."
  },
  { id: 40, text: "Diversifica√ß√£o com carteira Ibovespa Indexado + Long & Short Direcional. A estrat√©gia mais adequada √©:",
    options: ["comprar ADR de empresas brasileiras.","comprar calls de Ibovespa.","vender Ibovespa.","comprar LFT."],
    correct: 2,
    explain: "Para reduzir correla√ß√£o/direcional com o √≠ndice, a venda (short) de Ibovespa equilibra o risco de mercado."
  },
  { id: 41, text: "T√≠tulos no mercado norte-americano que implicam risco de reinvestimento de cupons:",
    options: ["T-Bills e T-Bonds","T-Notes e T-Bonds","T-Notes e T-Bills","T-Bills e TIPS"],
    correct: 1,
    explain: "Quem paga cupom tem risco de reinvestimento (Notes e Bonds). T-Bills s√£o zero-coupon."
  },
  { id: 42, text: "Open Finance + brindes (j√≥ias, cruzeiros, carro) para atrair portabilidade. Sob o C√≥digo ANBIMA de Distribui√ß√£o, essa pr√°tica:",
    options: [
      "vai de encontro ao princ√≠pio por caracterizar concorr√™ncia desleal/condi√ß√µes n√£o equitativas.",
      "vai de encontro por ferir boa-f√©, transpar√™ncia, dilig√™ncia e lealdade.",
      "n√£o vai de encontro se o cliente n√£o for prejudicado.",
      "n√£o vai de encontro porque agressividade √© essencial."
    ],
    correct: 1,
    explain: "Ofertas exageradas/macetes de capta√ß√£o ferem princ√≠pios de boa-f√©, transpar√™ncia e lealdade."
  },
  { id: 43, text: "Gest√£o: (I) t√©cnica e fundamentalista fazem parte do bottom-up; (II) fundamentalista foca curt√≠ssimo prazo; (III) t√©cnica usa padr√µes hist√≥ricos. Correto:",
    options: ["I e III, apenas.","I, II e III.","I e II, apenas.","II e III, apenas."],
    correct: 0,
    explain: "I e III corretas; an√°lise fundamentalista n√£o √© focada no curt√≠ssimo prazo (II falsa)."
  },
  { id: 44, text: "Deb√™ntures simples ‚Äì √© caracter√≠stica correta:",
    options: ["ter agente fiduci√°rio para representar a emissora.","vendidas via ofertas p√∫blicas ou privadas.","n√£o ter risco de cr√©dito com garantia real.","emitidas por bancos de investimento."],
    correct: 1,
    explain: "Podem ser colocadas por oferta p√∫blica ou privada; agente fiduci√°rio representa debenturistas (n√£o emissora)."
  },
  { id: 45, text: "FII com 120 PFs e ningu√©m >10% e negocia√ß√£o em bolsa. Nesse caso, os cotistas ter√£o:",
    options: ["isen√ß√£o de IR nos rendimentos distribu√≠dos, apenas.","isen√ß√£o de IR no ganho de capital, apenas.","incid√™ncia de IR nos rendimentos e no ganho de capital.","incid√™ncia de IR nos rendimentos distribu√≠dos, apenas."],
    correct: 0,
    explain: "Atendidos requisitos legais, rendimentos mensais isentos p/ PF; ganho de capital na venda das cotas √© tributado."
  },
  { id: 46, text: "Grupo quer servi√ßo ‚Äòprivate‚Äô, ve√≠culo exclusivo, etc. Sobre requisitos de pessoal/capacidade financeira:",
    options: [
      "para constituir ve√≠culo exclusivo para planejamento, capacidade ‚â• R$ 10 milh√µes (individual ou coletiva).",
      "para oferecer private: ‚â•75% do time de estrat√©gia certificado (CFP/CGA/CGE/CFA).",
      "se Sidney ou Walter sa√≠rem, o grupo fica abaixo do valor necess√°rio.",
      "se subir para 94% de gerentes com CFP no private, poder√° oferecer o servi√ßo."
    ],
    correct: 0,
    explain: "Par√¢metro cl√°ssico de mercado para ve√≠culo exclusivo/estruturas private considera capacidade financeira m√≠nima (p.ex., R$10 mi)."
  }
];

/** ========= Persist√™ncia ========= */
const KEY_RESPONSES = "simulado_pdf_respostas";
const KEY_ANSWERKEY = "simulado_pdf_gabarito";

/* Mantemos a compatibilidade com salvar/abrir */
function loadResponses() {
  try { return JSON.parse(localStorage.getItem(KEY_RESPONSES) || "{}"); }
  catch { return {}; }
}
function saveResponses(obj) {
  localStorage.setItem(KEY_RESPONSES, JSON.stringify(obj));
}
function loadAnswerKey() {
  // usa o `correct` de cada quest√£o como gabarito inicial;
  // se o usu√°rio importar/editar, sobrep√µe.
  try {
    const saved = JSON.parse(localStorage.getItem(KEY_ANSWERKEY) || "null");
    if (Array.isArray(saved)) return saved;
    return QUESTIONS.map(q => (typeof q.correct === "number" ? q.correct : null));
  } catch {
    return QUESTIONS.map(q => (typeof q.correct === "number" ? q.correct : null));
  }
}
function saveAnswerKey(arr) {
  localStorage.setItem(KEY_ANSWERKEY, JSON.stringify(arr));
}

/** ========= Render ========= */
const $questions = document.getElementById("questions");
const $statChip   = document.getElementById("statChip");
const $scoreChip  = document.getElementById("scoreChip");

let responses = loadResponses();        // { [id]: optIndex }
let answerKey = loadAnswerKey();        // [optIndex|null]
let showKey   = false;                  // controla "Mostrar respostas corretas"
let editKeyFor = null;                  // ainda √© poss√≠vel editar, se quiser
let lastScore = null;

function render() {
  $questions.innerHTML = "";

  QUESTIONS.forEach((q, idx) => {
    const selected   = responses[q.id];
    const correctIdx = answerKey[idx];

    let cardCls = "q-card";
    if (lastScore !== null && selected != null && correctIdx != null) {
      cardCls += (selected === correctIdx) ? " correct" : " wrong";
    }

    const card = document.createElement("div");
    card.className = cardCls;

    const head = document.createElement("div");
    head.className = "q-head";
    head.innerHTML = `
      <div>
        <div class="q-id">Quest√£o ${q.id}</div>
        <div class="q-title"></div>
      </div>
      <div class="footer">
        <button class="btn-ghost" data-edit="${q.id}">
          ${editKeyFor === q.id ? "Concluir gabarito" : "Editar gabarito"}
        </button>
      </div>
    `;
    card.appendChild(head);

    const body = document.createElement("div");
    body.className = "q-body";
    body.textContent = q.text;
    card.appendChild(body);

    const opts = document.createElement("div");
    opts.className = "opts";
    q.options.forEach((optText, optIdx) => {
      const optId = `q${q.id}_o${optIdx}`;
      const wrap = document.createElement("div");
      wrap.className = "opt";

      const radio = document.createElement("input");
      radio.type = "radio";
      radio.name = `q_${q.id}`;
      radio.id = optId;
      radio.checked = selected === optIdx;
      radio.disabled = editKeyFor === q.id;
      radio.addEventListener("change", () => {
        responses[q.id] = optIdx;
        saveResponses(responses);
        updateStats();
      });

      const label = document.createElement("label");
      label.htmlFor = optId;
      label.innerHTML = `<strong>${String.fromCharCode(65 + optIdx)})</strong> ${optText}`;

      // Estrela da correta (‚òÖ) apenas se mostrar explicitamente ou se estiver editando
      if (showKey || editKeyFor === q.id) {
        const star = document.createElement("span");
        star.className = "star";
        star.textContent = (correctIdx === optIdx) ? "‚òÖ" : "‚òÜ";
        star.title = "Alternativa correta";
        star.style.cursor = (editKeyFor === q.id) ? "pointer" : "default";
        if (editKeyFor === q.id) {
          star.addEventListener("click", () => {
            answerKey[idx] = optIdx;
            saveAnswerKey(answerKey);
            render();
          });
        }
        label.appendChild(star);
      }

      wrap.appendChild(radio);
      wrap.appendChild(label);
      opts.appendChild(wrap);
    });
    card.appendChild(opts);

    const meta = document.createElement("div");
    meta.className = "meta";
    
    // Mostra o gabarito apenas quando "Mostrar respostas corretas" estiver ativo
    if (showKey) {
      const ansInfo = document.createElement("div");
      ansInfo.className = "small";
      ansInfo.innerHTML =
        (answerKey[idx] != null)
          ? `Gabarito: <strong>${"ABCD"[answerKey[idx]]}</strong>`
          : `Gabarito: <span class="danger">n√£o definido</span>`;
      meta.appendChild(ansInfo);
    }
    
    card.appendChild(meta);

    // Coment√°rio do especialista (exibe apenas quando mostrar gabarito explicitamente)
    if (showKey && q.explain) {
      const exp = document.createElement("div");
      exp.className = "explain";
      exp.textContent = "Coment√°rio: " + q.explain;
      card.appendChild(exp);
    }

    // Bot√£o editar gabarito handler
    head.querySelector("[data-edit]").addEventListener("click", () => {
      editKeyFor = (editKeyFor === q.id) ? null : q.id;
      render();
    });

    $questions.appendChild(card);
  });

  updateStats();
}

function updateStats() {
  const total = QUESTIONS.length;
  const answered = Object.keys(responses).length;
  $statChip.textContent = `${answered}/${total} respondidas`;

  if (lastScore == null) {
    $scoreChip.textContent = "Sem corre√ß√£o";
  } else {
    const pct = (100*lastScore.acertos/QUESTIONS.length).toFixed(1);
    $scoreChip.innerHTML = `Nota: <strong>${lastScore.acertos}</strong> / ${QUESTIONS.length} (${pct}%)`;
  }
}

function grade() {
  let acertos = 0, semGabarito = 0;
  QUESTIONS.forEach((q, i) => {
    const s = responses[q.id];
    const g = answerKey[i];
    if (g == null) { semGabarito++; return; }
    if (s === g) acertos++;
  });
  lastScore = { acertos, semGabarito };
  render();
  if (semGabarito > 0) {
    alert(`Existem ${semGabarito} quest√£o(√µes) sem gabarito definido. Use ‚ÄúEditar gabarito‚Äù para marc√°-las.`);
  }
}

/** ========= Bot√µes ========= */
document.getElementById("submitBtn").addEventListener("click", grade);

document.getElementById("resetBtn").addEventListener("click", () => {
  if (!confirm("Limpar todas as respostas?")) return;
  responses = {};
  saveResponses(responses);
  lastScore = null;
  render();
});

document.getElementById("toggleKey").addEventListener("click", (e) => {
  showKey = !showKey;
  e.target.textContent = showKey ? "üôà Ocultar respostas corretas" : "üëÅÔ∏è Mostrar respostas corretas";
  render();
});

document.getElementById("exportKey").addEventListener("click", () => {
  const data = {
    answerKey,
    responses,
    meta: { source: "CEA/ANBIMA (transcri√ß√£o do seu PDF) ‚Äì gabarito e coment√°rios por entendimento t√©cnico", when: new Date().toISOString() }
  };
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "simulado_gabarito_respostas.json";
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

document.getElementById("importKeyInput").addEventListener("change", (ev) => {
  const file = ev.target.files?.[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const obj = JSON.parse(reader.result);
      if (Array.isArray(obj.answerKey)) {
        answerKey = obj.answerKey;
        saveAnswerKey(answerKey);
      }
      if (obj.responses && typeof obj.responses === "object") {
        responses = obj.responses;
        saveResponses(responses);
      }
      lastScore = null;
      render();
      alert("Importado com sucesso!");
    } catch (e) {
      alert("Arquivo inv√°lido.");
    }
  };
  reader.readAsText(file);
});

/** ========= Boot ========= */
render();
</script>
</body>
</html>
